<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Clientes</ion-title>
    <button onclick="window.location.href='/home'" class="nav-link">volver</button>
  </ion-toolbar>
</ion-header>

<div class="page-container">
  
  <!-- CARD 1: FORMULARIO -->
  <div class="card">

    <!-- Mensaje de error -->
    <div *ngIf="mensajeError" class="error-box">
      ‚ö†Ô∏è {{ mensajeError }}
    </div>

    <!-- Formulario -->
    <form (ngSubmit)="guardar()">

      <!-- RUT -->
      <div class="mb-4">
        <label class="block text-sm font-semibold mb-2">RUT *</label>
        <input 
          [(ngModel)]="cliente.rut" 
          name="rut" 
          type="text"
          placeholder="Ej: 12345678-9"
          class="border border-gray-300 p-3 rounded w-full focus:outline-none focus:border-blue-500"
          required
        />
      </div>

      <!-- Nombre o Raz√≥n Social -->
      <div class="mb-4">
        <label class="block text-sm font-semibold mb-2">Nombre o Raz√≥n Social *</label>
        <input 
          [(ngModel)]="cliente.nombre_razon" 
          name="nombre_razon" 
          type="text"
          placeholder="Ej: Mi Empresa S.A."
          class="border border-gray-300 p-3 rounded w-full focus:outline-none focus:border-blue-500"
          required
        />
      </div>

      <!-- Email -->
      <div class="mb-4">
        <label class="block text-sm font-semibold mb-2">Email *</label>
        <input 
          [(ngModel)]="cliente.email_contacto" 
          name="email_contacto" 
          type="email"
          placeholder="Ej: info@empresa.com"
          class="border border-gray-300 p-3 rounded w-full focus:outline-none focus:border-blue-500"
          required
        />
      </div>

      <!-- Tel√©fono -->
      <div class="mb-4">
        <label class="block text-sm font-semibold mb-2">Tel√©fono</label>
        <input 
          [(ngModel)]="cliente.telefono" 
          name="telefono" 
          type="text"
          placeholder="Ej: +56912345678"
          class="border border-gray-300 p-3 rounded w-full focus:outline-none focus:border-blue-500"
        />
      </div>

      <!-- Direcci√≥n -->
      <div class="mb-4">
        <label class="block text-sm font-semibold mb-2">Direcci√≥n *</label>
        <input 
          [(ngModel)]="cliente.direccion_facturacion" 
          name="direccion_facturacion" 
          type="text"
          placeholder="Ej: Calle Principal 123"
          class="border border-gray-300 p-3 rounded w-full focus:outline-none focus:border-blue-500"
          required
        />
      </div>

      <!-- Ciudad -->
      <div class="mb-6">
        <label class="block text-sm font-semibold mb-2">Ciudad</label>
        <input 
          [(ngModel)]="cliente.ciudad" 
          name="ciudad" 
          type="text"
          placeholder="Ej: Santiago"
          class="border border-gray-300 p-3 rounded w-full focus:outline-none focus:border-blue-500"
        />
      </div>

      <!-- Botones -->
      <div class="flex gap-4">
        <button 
          type="submit"
          [disabled]="cargando"
          class="btn-primary"
        >
          {{ cargando ? '‚è≥ Guardando...' : (modoEdicion ? 'üíæ Actualizar' : '‚ûï Crear') }}
        </button>

        <button 
          type="button"
          class="btn-danger"
          [disabled]="cargando"
          (click)="cancelar()"
        >
          ‚ùå Cancelar
        </button>
      </div>

    </form>

    <!-- Informaci√≥n √∫til -->
    <div class="mt-8 p-4 bg-blue-50 rounded border-l-4 border-blue-500">
      <p class="text-sm text-gray-700">
        <strong>Nota:</strong> Los campos marcados con (*) son requeridos.
      </p>
    </div>

  </div>

  <!-- CARD 2: LISTA DE CLIENTES -->
  <div class="card card-lista">

    <!-- T√≠tulo lista -->
    <h2 class="text-lg font-semibold mb-4">Lista de clientes</h2>

    <!-- Estado de carga -->
    <div *ngIf="cargando" class="text-sm text-gray-500 mb-2">
      Cargando clientes...
    </div>

    <!-- Sin datos -->
    <div *ngIf="!cargando && clientes.length === 0" class="text-sm text-gray-500">
      No hay clientes registrados.
    </div>

    <!-- Tabla de clientes -->
    <div *ngIf="clientes.length > 0" class="overflow-x-auto">
      <table class="tabla-clientes border border-gray-200 text-sm">
        <thead class="bg-gray-100">
          <tr>
            <th class="p-2 border border-gray-200 text-left">RUT</th>
            <th class="p-2 border border-gray-200 text-left">Nombre / Raz√≥n</th>
            <th class="p-2 border border-gray-200 text-left">Email</th>
            <th class="p-2 border border-gray-200 text-left">Tel√©fono</th>
            <th class="p-2 border border-gray-200 text-left">Direcci√≥n</th>
            <th class="p-2 border border-gray-200 text-left">Ciudad</th>
            <th class="p-2 border border-gray-200 text-left">Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let c of clientes" class="hover:bg-gray-50">
            <td class="p-2 border border-gray-200">{{ c.rut }}</td>
            <td class="p-2 border border-gray-200">{{ c.nombre_razon }}</td>
            <td class="p-2 border border-gray-200">{{ c.email_contacto }}</td>
            <td class="p-2 border border-gray-200">{{ c.telefono }}</td>
            <td class="p-2 border border-gray-200">{{ c.direccion_facturacion }}</td>
            <td class="p-2 border border-gray-200">{{ c.ciudad }}</td>
            <td class="p-2 border border-gray-200">
              <button 
                type="button" 
                class="btn-primary mr-2"
                (click)="editarCliente(c)"
              >
                ‚úèÔ∏è Editar
              </button>
              <button 
                type="button" 
                class="btn-danger"
                (click)="eliminarCliente(c.id_cliente || c.id)"
              >
                üóë Eliminar
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

  </div>

</div>
