<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Medidores</ion-title>
    <button onclick="window.location.href='/home'" class="nav-link">â¬… Volver</button>
    
  </ion-toolbar>
</ion-header>

<ion-content>
  <div class="page-container">

    <!-- CARD 1: FORM -->
    <div class="card">
      <div *ngIf="mensajeError" class="error-box">âš ï¸ {{ mensajeError }}</div>

      <h2 class="card-title">{{ modoEdicion ? "âœï¸ Editar Medidor" : "â• Nuevo Medidor" }}</h2>

      <form (ngSubmit)="guardar()">
        <label class="label">CÃ³digo del Medidor *</label>
        <input class="input" [(ngModel)]="medidor.codigo_medidor" name="codigo_medidor" required placeholder="MED-00123" [readonly]="modoEdicion" />

        <label class="label">RUT del Cliente *</label>
        <input class="input" [(ngModel)]="medidor.rut_cliente" name="rut_cliente" (blur)="buscarClientePorRut()" required placeholder="12.345.678-9" />

        <label class="label">DirecciÃ³n de suministro</label>
        <input class="input" [(ngModel)]="medidor.direccion_suministro" name="direccion_suministro" placeholder="Calle / nÃºmero" />

        <label class="label">Estado</label>
        <select class="input" [(ngModel)]="medidor.estado" name="estado">
          <option value="activo">Activo</option>
          <option value="inactivo">Inactivo</option>
        </select>

        <div class="button-row">
          <button type="submit" [disabled]="cargando" class="btn-primary">
            {{ cargando ? "â³ Guardando..." : (modoEdicion ? "ğŸ’¾ Actualizar" : "â• Crear") }}
          </button>
          <button type="button" class="btn-danger" (click)="cancelar()" [disabled]="cargando">âŒ Cancelar</button>
        </div>
      </form>

      <div class="note">Los campos marcados con (*) son requeridos.</div>
    </div>

    <!-- CARD 2: LIST -->
    <div class="card card-lista">
      <h2 class="card-title">Lista de Medidores</h2>

      <div *ngIf="cargando" class="muted">Cargando medidores...</div>
      <div *ngIf="!cargando && medidores.length === 0" class="muted">No hay medidores registrados.</div>

      <div *ngIf="medidores.length > 0" class="table-wrap">
        <table class="tabla-clientes">
          <thead>
            <tr>
              <th>CÃ³digo</th>
              <th>RUT Cliente</th>
              <th>DirecciÃ³n</th>
              <th>Estado</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let m of medidores">
              <td>{{ m.codigo_medidor }}</td>
              <td>{{ m.cliente?.rut || m.rut_cliente || '' }}</td>
              <td>{{ m.direccion_suministro }}</td>
              <td><span class="estado" [ngClass]="m.estado === 'activo' ? 'activo' : 'inactivo'">{{ m.estado }}</span></td>
              <td class="td-actions">
                <button class="btn-primary" (click)="editarMedidor(m)">âœï¸ Editar</button>
                <button class="btn-danger" (click)="eliminarMedidor(m.id_medidor)">ğŸ—‘ Eliminar</button>
